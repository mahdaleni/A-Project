<!DOCTYPE HTML>
<html>

<head>
    <title>
        nativeDroid II - jQueryMobile Template
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="css/font-awesome.min.css" />
    <link rel="stylesheet" href="css/jquery.mobile.min.css" />
    <link rel="stylesheet" href="css/waves.min.css" />
    <link rel="stylesheet" href="css/animate.css" />
    <link rel="stylesheet" href="css/nativedroid2.css" />
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.2.3/firebase.js"></script>
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false&v=3.19"></script>
    
    
    
    
    
    
    <style>
        body {
            opacity: 0;
        }
    </style>
</head>

<body>
    <div data-role="page">
        
        
        
        
        
         <script type="text/javascript">
		var map;
		markers = [];
		var PointsRef = new Firebase('https://mapsomething.firebaseio.com/points');
		var LinesRef = new Firebase('https://mapsomething.firebaseio.com/lines');
		var PolygonsRef = new Firebase('https://mapsomething.firebaseio.com/polygons');
		var MapRef = new Firebase('https://mapsomething.firebaseio.com/mapData');
		var CenterRef = new Firebase('https://mapsomething.firebaseio.com/mapData/centerLatLng');
		var ZoomRef = new Firebase('https://mapsomething.firebaseio.com/mapData/mapZoom');
		
		PointsRef.on('child_added', function(snapshot) {
			var location = new google.maps.LatLng(snapshot.val().pointLatLng.Lat, snapshot.val().pointLatLng.Lng);
			var marker = new google.maps.Marker({
				position: location, 
				map: map,
				key: snapshot.key()
			});
			markers.push(marker);
			console.log(typeof marker);
			console.log(marker);
		});
		
		PointsRef.on('child_removed', function(snapshot) {
			for (var i = 0; i < markers.length; i++) {
				if (markers[i].key == snapshot.key()) {
					markers[i].setMap(null);
				}
			}
		});
		
		CenterRef.on('value', function(snapshot) {
			var center = new google.maps.LatLng(snapshot.val().Lat, snapshot.val().Lng);
			//if (map.getCenter() != center) {
				map.setCenter(center);
			//}
		});
		
		ZoomRef.on('value', function(snapshot) {
			var zoom = snapshot.val();
			if (map.getZoom() != zoom) {
				map.setZoom(zoom);
				console.log(zoom);
			}
		});
				
		function initialize() {
			var mapOptions = {
				center: new google.maps.LatLng(53.917, -122.75),
				zoom: 8,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};
			map = new google.maps.Map(document.getElementById("map"),mapOptions);

			google.maps.event.addListener(map, 'click', function(event) {
				if (document.getElementById('radPoint').checked && document.getElementById('radDraw').checked) {
					var jsonVariable = {
						pointLatLng: {
							Lat: event.latLng.lat(),
							Lng: event.latLng.lng()
						}
					}
					PointsRef.push(jsonVariable);
				} else if (document.getElementById('radLine').checked) {
					console.log('lnclick');
				} else if (document.getElementById('radPolygon').checked) {
					console.log('polyclick');
				}
				
				
			});
			
			google.maps.event.addListener(map, 'center_changed', function() {
				var center = map.getCenter();
				var zoom = map.getZoom();
				var jsonVariable = {
					centerLatLng: {
						Lat: center.lat(),
						Lng: center.lng()
					}
				}
				MapRef.update(jsonVariable);
			});
			
			google.maps.event.addListener(map, 'zoom_changed', function() {
				var center = map.getCenter();
				var zoom = map.getZoom();
				var jsonVariable = {
					mapZoom: zoom
				}
				MapRef.update(jsonVariable);
			});
			
		}
		
		function eraseAll() {
			PointsRef.remove();
		}
		
		google.maps.event.addDomListener(window, 'load', initialize);
    </script>
        
        
        
        
        
        
        
        <nd2-include data-src="panel.left.html">
        </nd2-include>
        <div data-role="header" data-position="fixed">
            <a href="#leftpanel" class="ui-btn ui-btn-left"><i class="fa fa-bars"></i></a>
            <h1>
                Profile
            </h1>
        </div>
        <div role="main" class="ui-content" data-inset="false">
            content here.
        </div>
        
        
        
        
        
        
          <div id="divControls">
		<input type="radio" name="geomType" id="radPoint" value="Point" checked>Point</input><br>
		<input type="radio" name="geomType" id="radLine" value="Line" disabled>Line</input><br>
		<input type="radio" name="geomType" id="radPolygon" value="Polygon" disabled>Polygon</input><br>
		<hr>
		<input type="radio" name="drawType" id="radDraw" value="Draw" checked>Draw</input><br>
		<input type="radio" name="drawType" id="radErase" value="Erase"disabled>Erase</input>
		<hr>
		<input type="button" id="btnEraseAll" value="Erase All" onclick="eraseAll();"></input>
	</div>
	<div id="map"/>
        
        
        
        
        
        
    </div>
    <script type="text/javascript" src="cordova.js">
    </script>
    <script src="scripts/jquery.min.js">
    </script>
    <script src="scripts/jquery.mobile.min.js">
    </script>
    <script src="scripts/waves.min.js">
    </script>
    <script src="scripts/wow.min.js">
    </script>
    <script src="scripts/nativedroid2.js">
    </script>
    <script src="scripts/nd2settings.js">
    </script>
</body>

</html>
